services:
  - type: worker
    name: topdon-raport
    env: node
    autoDeploy: true

    # Build & start
    buildCommand: yarn
    startCommand: node index.js

    # (optional) fixează versiunea Node dacă vrei stabilitate
    envVars:
      - key: NODE_VERSION
        value: 22.16.0

      # --- IMAP (Gmail) ---
      - key: IMAP_HOST
        value: imap.gmail.com
      - key: IMAP_PORT
        value: "993"
      - key: IMAP_SECURE
        value: "true"
      - key: IMAP_USER
        sync: false         # setezi in Render Dashboard
      - key: IMAP_PASS
        sync: false         # App Password de 16 caractere

      # --- Căutare & polling ---
      - key: MAILBOX
        value: INBOX
      - key: SEARCH_QUERY
        value: 'UNSEEN'
      - key: POLL_INTERVAL_MS
        value: "120000"     # 120s

      # --- PDF / Template ---
      - key: REPORT_TEMPLATE
        value: vw_cv_2016
      - key: REMOVE_DIACRITICS
        value: "true"
      - key: SITE_LOCALE
        value: ro-RO

      # --- SMTP (trimitere raport pe email) ---
      - key: SMTP_HOST
        value: smtp.gmail.com
      - key: SMTP_PORT
        value: "465"
      - key: SMTP_SECURE
        value: "true"
      - key: SMTP_USER
        sync: false         # adresa ta Gmail
      - key: SMTP_PASS
        sync: false         # App Password (poate fi același)

      # --- OpenAI (dacă folosești sumarizare/explicații) ---
      - key: OPENAI_API_KEY
        sync: false

      # --- Upload extern (opțional: S3 / Cloudflare R2) ---
      - key: STORAGE_PROVIDER
        value: s3
      - key: S3_ENDPOINT
        sync: false
      - key: S3_BUCKET
        sync: false
      - key: S3_REGION
        value: auto
      - key: S3_ACCESS_KEY_ID
        sync: false
      - key: S3_SECRET_ACCESS_KEY
        sync: false
      - key: S3_PUBLIC_BASE
        sync: false         # URL-ul public/CDN pt. linkul final

      # --- Notificări Slack (opțional) ---
      - key: SLACK_WEBHOOK_URL
        sync: false
